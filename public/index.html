<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>魔方解法大師</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
  <script src="https://cdn.cubing.net/v0/js/cubing/twisty" type="module"></script>
</head>
<body>
  
  <header class="app-header">
    <h1>魔方解法大師</h1>
  </header>

  <div class="container">
    
    <div class="control-panel card">
      <div class="action-buttons">
        <button class="btn btn-primary solve-btn" onclick="getCubeSolution()">
          <span class="icon">🧩</span> 開始解法
        </button>
        <button class="btn btn-secondary scan-btn" onclick="startCamera()">
          <span class="icon">📷</span> 相機掃描
        </button>
        <a href="https://youtu.be/CTUDGKrjM7M?si=71wZy6LbYLOeWUkj" target="_blank" class="btn btn-outline tutorial-btn">
          <span class="icon">📺</span> 教學影片
        </a>
      </div>
      
      <div class="animation-control">
        <label for="animation-select">動畫模式：</label>
        <div class="select-wrapper">
          <select id="animation-select" onchange="updateAnimation()">
            <option value="restore">還原步驟</option>
            <option value="reverse">打亂步驟</option>
            <option value="white-cross">白底十字教學</option>
          </select>
        </div>
      </div>
    </div>

    <div id="result-container" class="result-card card hidden">
      <div id="result"></div>
    </div>

    <div class="main-content">
      
      <section class="left-section card">
        <h2 class="section-title">1. 設定狀態</h2>
        <div class="color-picker-container">
          <p class="instruction">選擇顏色並點擊下方展開圖</p>
          <div class="color-picker" id="colorPicker">
            <button class="color-btn active" data-color="white" onclick="setColor('white')"></button>
            <button class="color-btn" data-color="red" onclick="setColor('red')"></button>
            <button class="color-btn" data-color="green" onclick="setColor('green')"></button>
            <button class="color-btn" data-color="yellow" onclick="setColor('yellow')"></button>
            <button class="color-btn" data-color="orange" onclick="setColor('orange')"></button>
            <button class="color-btn" data-color="blue" onclick="setColor('blue')"></button>
          </div>
        </div>

        <div class="cube-map-container">
          <div class="face-group top">
            <span class="face-label">U (上)</span>
            <div id="U" class="face"></div>
          </div>
          <div class="middle-row">
            <div class="face-group">
              <span class="face-label">L (左)</span>
              <div id="L" class="face"></div>
            </div>
            <div class="face-group">
              <span class="face-label">F (前)</span>
              <div id="F" class="face"></div>
            </div>
            <div class="face-group">
              <span class="face-label">R (右)</span>
              <div id="R" class="face"></div>
            </div>
            <div class="face-group">
              <span class="face-label">B (後)</span>
              <div id="B" class="face"></div>
            </div>
          </div>
          <div class="face-group bottom">
            <span class="face-label">D (下)</span>
            <div id="D" class="face"></div>
          </div>
        </div>
      </section>

      <section class="right-section card">
        <h2 class="section-title">2. 預覽與紀錄</h2>
        <div class="animation-wrapper">
          <twisty-player 
            id="twisty-player" 
            puzzle="3x3x3" 
            control-panel="bottom-row" 
            background="none"
            experimental-auto-play="false"
          ></twisty-player>
        </div>

        <div class="records-container">
          <div class="records-header">
            <h3>歷史紀錄</h3>
            <button class="icon-btn clear-records-btn" onclick="clearRecords()" title="清除紀錄">🗑️</button>
          </div>
          <div class="record-boxes" id="record-boxes">
            <div class="empty-state">尚無紀錄</div>
          </div>
        </div>
      </section>
    </div>

    <div id="cubeString" class="cube-string-footer">
      <span>識別碼：</span><span id="cubeStringContent">...</span>
    </div>
  </div>

  <div id="camera-container" class="camera-modal">
    <div class="camera-content">
      <div class="video-wrapper">
        <video id="video" autoplay playsinline></video>
        <canvas id="grid-canvas"></canvas>
        <div class="camera-overlay">
          <span id="face-indicator" class="face-badge">U</span>
          <p class="camera-hint">將魔方中心對準網格</p>
        </div>
      </div>
      
      <div class="camera-controls">
        <button class="circle-btn stop-btn" onclick="stopCamera()" title="關閉">
          <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
        <button class="circle-btn capture-btn" onclick="captureFace()" title="拍攝">
          <div class="shutter-inner"></div>
        </button>
        <div class="camera-buttons-top" id="dynamic-confirm-area">
        </div>
      </div>
    </div>
  </div>
  
  <script src="/script.js"></script>
</body>
</html>